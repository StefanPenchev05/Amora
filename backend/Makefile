# ---------- Backend Makefile ----------
SHELL := /bin/bash

# Colors
BLUE := \033[34m
GREEN := \033[32m
YELLOW := \033[33m
RED := \033[31m
CYAN := \033[36m
RESET := \033[0m

APP_NAME ?= server
MAIN ?= ./cmd/api
BIN_DIR ?= bin
BINARY = $(BIN_DIR)/$(APP_NAME)

# All go files incremental build
SRC := $(shell find . -type f -name '*.go')

# File-target for incremental build
$(BINARY): $(SRC)
	@printf "$(CYAN)ğŸ”¨ Creating binary directory...$(RESET)\n"
	@mkdir -p $(BIN_DIR)
	@printf "$(YELLOW)âš¡ Building Go binary for Linux...$(RESET)\n"
	@CGO_ENABLED=0 GOOS=linux go build -trimpath -ldflags="-s -w" -o $@ $(MAIN)
	@printf "$(GREEN)âœ… Binary built successfully: $(BINARY)$(RESET)\n"

.PHONY: build run test fmt clean

build: $(BINARY)
	@printf "$(GREEN)ğŸ‰ Build completed! Ready to deploy.$(RESET)\n"

run:
	@printf "$(CYAN)ğŸš€ Starting development server...$(RESET)\n"
	@printf "$(BLUE)ğŸ“ Running from: $(MAIN)$(RESET)\n"
	@go run $(MAIN)

test:
	@printf "$(CYAN)ğŸ§ª Running Go tests...$(RESET)\n"
	@go test ./... -v
	@printf "$(GREEN)âœ… All tests completed$(RESET)\n"

fmt:
	@printf "$(CYAN)ğŸ“ Formatting Go code...$(RESET)\n"
	@go fmt ./...
	@printf "$(GREEN)âœ… Code formatted successfully$(RESET)\n"

clean:
	@printf "$(YELLOW)ğŸ§¹ Cleaning build artifacts...$(RESET)\n"
	@rm -rf $(BIN_DIR)
	@printf "$(GREEN)âœ… Clean completed$(RESET)\n"
	



