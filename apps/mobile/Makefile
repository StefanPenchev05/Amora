# ---------- Mobile Makefile ----------
SHELL := /bin/bash

# Colors
BLUE := \033[34m
GREEN := \033[32m
YELLOW := \033[33m
RED := \033[31m
CYAN := \033[36m
RESET := \033[0m

.PHONY: install dev build build-dev build-ios build-android test lint clean start-ios start-android setup-eas

install:
	@printf "$(CYAN)ğŸ“¦ Installing mobile dependencies...$(RESET)\n"
	@npm install
	@printf "$(GREEN)âœ… Mobile dependencies installed!$(RESET)\n"

dev:
	@printf "$(CYAN)ğŸ“± Starting Expo development server...$(RESET)\n"
	@printf "$(BLUE)ğŸŒ Expo DevTools will open in your browser$(RESET)\n"
	@npx expo start

start-ios:
	@printf "$(CYAN)ğŸ“± Starting iOS simulator...$(RESET)\n"
	@npx expo start --ios

start-android:
	@printf "$(CYAN)ğŸ“± Starting Android emulator...$(RESET)\n"
	@npx expo start --android

build:
	@printf "$(CYAN)ğŸ—ï¸ Building mobile app for production...$(RESET)\n"
	@printf "$(BLUE)ğŸ“± Creating optimized bundle...$(RESET)\n"
	@npx expo export --platform all
	@printf "$(GREEN)âœ… Mobile build complete! Check dist/ folder$(RESET)\n"

build-dev:
	@printf "$(CYAN)ğŸ“¦ Creating development build...$(RESET)\n"
	@npx expo export --dev
	@printf "$(GREEN)âœ… Development build complete!$(RESET)\n"

build-ios:
	@printf "$(CYAN)ğŸ Building for iOS (requires EAS Build)...$(RESET)\n"
	@npx eas build --platform ios --non-interactive 2>/dev/null || \
	printf "$(YELLOW)âš ï¸  Run 'make setup-eas' to configure EAS Build first$(RESET)\n"

build-android:
	@printf "$(CYAN)ğŸ¤– Building for Android (requires EAS Build)...$(RESET)\n"
	@npx eas build --platform android --non-interactive 2>/dev/null || \
	printf "$(YELLOW)âš ï¸  Run 'make setup-eas' to configure EAS Build first$(RESET)\n"

setup-eas:
	@printf "$(CYAN)âš™ï¸  Setting up EAS Build...$(RESET)\n"
	@npx eas build:configure
	@printf "$(GREEN)âœ… EAS Build configured! Now you can use build-ios/build-android$(RESET)\n"

test:
	@printf "$(CYAN)ğŸ§ª Running mobile tests...$(RESET)\n"
	@npm test
	@printf "$(GREEN)âœ… Mobile tests completed$(RESET)\n"

lint:
	@printf "$(CYAN)ğŸ” Linting mobile TypeScript code...$(RESET)\n"
	@npm run lint
	@printf "$(GREEN)âœ… Mobile linting completed$(RESET)\n"

clean:
	@printf "$(YELLOW)ğŸ§¹ Cleaning mobile build artifacts...$(RESET)\n"
	@rm -rf .expo dist node_modules/.cache
	@printf "$(GREEN)âœ… Mobile cleanup complete!$(RESET)\n"
